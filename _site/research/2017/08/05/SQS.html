<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How to use SQS for disordered materials</title>
  <meta name="description" content="Table of Contents">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/research/2017/08/05/SQS.html">
  <link rel="alternate" type="application/rss+xml" title="Changning Niu" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Changning Niu</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/">Home</a>
          
            
            
            <a class="page-link" href="/blog/">Blog</a>
            
          
            
            
          
            
            
            <a class="page-link" href="/research/">Research</a>
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">How to use SQS for disordered materials</h1>
    <p class="post-meta">
      <time datetime="2017-08-05T11:57:25-04:00" itemprop="datePublished">
        
        Aug 5, 2017
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><em>Table of Contents</em></p>
<ul id="markdown-toc">
  <li><a href="#preface" id="markdown-toc-preface">Preface</a></li>
  <li><a href="#compile-a-mcsqs-that-saves-all-bestsqs" id="markdown-toc-compile-a-mcsqs-that-saves-all-bestsqs">Compile a mcsqs that saves all bestsqs</a></li>
  <li><a href="#generate-sqs" id="markdown-toc-generate-sqs">Generate SQS</a>    <ul>
      <li><a href="#run-corrdump" id="markdown-toc-run-corrdump">Run corrdump</a>        <ul>
          <li><a href="#the-rndstrin-file" id="markdown-toc-the-rndstrin-file">The rndstr.in file</a></li>
          <li><a href="#the--2--3-parameters" id="markdown-toc-the--2--3-parameters">The “-2, -3” parameters</a></li>
        </ul>
      </li>
      <li><a href="#run-mcsqs" id="markdown-toc-run-mcsqs">Run mcsqs</a>        <ul>
          <li><a href="#regular-search" id="markdown-toc-regular-search">Regular search</a></li>
          <li><a href="#search-with-a-fixed-cell" id="markdown-toc-search-with-a-fixed-cell">Search with a fixed cell</a></li>
          <li><a href="#search-for-sqs-like-a-cube" id="markdown-toc-search-for-sqs-like-a-cube">Search for SQS like a cube</a></li>
        </ul>
      </li>
      <li><a href="#convert-sqs-to-poscar" id="markdown-toc-convert-sqs-to-poscar">Convert SQS to POSCAR</a></li>
    </ul>
  </li>
  <li><a href="#faqs" id="markdown-toc-faqs">FAQs</a>    <ul>
      <li><a href="#how-to-tell-if-a-sqs-is-good" id="markdown-toc-how-to-tell-if-a-sqs-is-good">How to tell if a SQS is good?</a></li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>This article assumes the reader already has basic knowledge about Special Quasi-random Structure (SQS).</p>
</blockquote>

<h2 id="preface">Preface</h2>
<p>I am a co-author of <em>Chapter 10: Applications of Special Quasi-random Structures to High-Entropy Alloys</em> (M. C. Gao, C. Niu, C. Jiang, D. L. Irving) of the book <em>High-Entropy Alloys</em> (Ed. M. C. Gao, J. W. Yeh, P. K. Liaw, Y. Zhang, Springer, 2016). This chapter focuses on the application of SQS in research with a wide variety of topics. Often, some researchers who begin to use SQS email me, asking about more basic usage of SQS. So I wrote this article, focusing on its basic usage with practical tips.</p>

<p><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>

<h2 id="compile-a-mcsqs-that-saves-all-bestsqs">Compile a mcsqs that saves all bestsqs</h2>
<p>There is no need for me to introduce how to compile ATAT here; the manual has clear instructions. However, I have a minor complaint about how the <code class="highlighter-rouge">mcsqs</code> code handles intermediate SQS – it only saves the last one it finds as <code class="highlighter-rouge">bestsqs.out</code>. Even though this makes sense in that the last one always has the best matched correlation functions, there are other factors one needs to consider when selecting a SQS, e.g., the shape of the cell. It is better if all SQS (whether perfect or imperfect) are stored with their correlation functions. This also helps if the user uses a bestsqs for further calculations before the <code class="highlighter-rouge">mcsqs</code> finishes searching, and now there is no risk that this bestsqs gets overwritten.</p>

<p>To have this modified version, find the following lines in <code class="highlighter-rouge">atat/src/mcsqs.c++</code> before compilation:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="c1">// Line 425 of mcsqs.c++
</span><span class="kt">int</span> <span class="n">tic</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">Real</span> <span class="n">obj</span><span class="o">=</span><span class="n">best</span><span class="p">.</span><span class="n">obj</span><span class="p">;</span>
<span class="n">best</span><span class="p">.</span><span class="n">obj</span><span class="o">=</span><span class="n">MAXFLOAT</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="o">&lt;</span><span class="n">best</span><span class="p">.</span><span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// cerr &lt;&lt; "Best" &lt;&lt; endl;
</span>    <span class="n">best</span><span class="o">=</span><span class="n">mc</span><span class="p">(</span><span class="n">cc</span><span class="p">);</span>
    <span class="n">ofstream</span> <span class="n">strfile</span><span class="p">;</span>
    <span class="n">open_numbered_file</span><span class="p">(</span><span class="n">strfile</span><span class="p">,</span> <span class="s">"bestsqs"</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="s">".out"</span><span class="p">);</span>
    <span class="n">strfile</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios</span><span class="o">::</span><span class="n">fixed</span><span class="p">);</span>
    <span class="n">strfile</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="n">sigdig</span><span class="p">);</span>
    <span class="n">write_structure</span><span class="p">(</span><span class="n">best</span><span class="p">.</span><span class="n">str</span><span class="p">,</span><span class="n">ulat</span><span class="p">,</span><span class="n">site_type_list</span><span class="p">,</span><span class="n">atom_label</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">strfile</span><span class="p">);</span>
    <span class="n">ofstream</span> <span class="n">corrfile</span><span class="p">;</span>
    <span class="n">open_numbered_file</span><span class="p">(</span><span class="n">corrfile</span><span class="p">,</span> <span class="s">"bestcorr"</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="s">".out"</span><span class="p">);</span>
    <span class="n">corrfile</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios</span><span class="o">::</span><span class="n">fixed</span><span class="p">);</span>
    <span class="n">corrfile</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="n">sigdig</span><span class="p">);</span>
</code></pre>
</div>
<p>Replace the lines above with the following lines:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">tic</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">Real</span> <span class="n">obj</span><span class="o">=</span><span class="n">best</span><span class="p">.</span><span class="n">obj</span><span class="p">;</span>
<span class="n">best</span><span class="p">.</span><span class="n">obj</span><span class="o">=</span><span class="n">MAXFLOAT</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">count_cniu</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>                                       <span class="c1">// added by cniu
</span><span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="o">&lt;</span><span class="n">best</span><span class="p">.</span><span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// cerr &lt;&lt; "Best" &lt;&lt; endl;
</span>    <span class="n">best</span><span class="o">=</span><span class="n">mc</span><span class="p">(</span><span class="n">cc</span><span class="p">);</span>
    <span class="n">ofstream</span> <span class="n">strfile</span><span class="p">;</span>
    <span class="n">stringstream</span> <span class="n">out_cniu</span><span class="p">;</span>                              <span class="c1">// added by cniu
</span>    <span class="n">out_cniu</span> <span class="o">&lt;&lt;</span> <span class="n">count_cniu</span><span class="o">++</span><span class="p">;</span>                           <span class="c1">// added by cniu
</span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str1_cniu</span> <span class="o">=</span> <span class="s">"bestsqs-"</span><span class="p">;</span>                 <span class="c1">// added by cniu
</span>    <span class="n">str1_cniu</span> <span class="o">+=</span> <span class="n">out_cniu</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>                        <span class="c1">// added by cniu
</span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str2_cniu</span> <span class="o">=</span> <span class="s">"bestcorr-"</span><span class="p">;</span>                <span class="c1">// added by cniu
</span>    <span class="n">str2_cniu</span> <span class="o">+=</span> <span class="n">out_cniu</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>                        <span class="c1">// added by cniu
</span>    <span class="kt">char</span> <span class="o">*</span><span class="n">cstr1_cniu</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">str1_cniu</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>  <span class="c1">// added by cniu
</span>    <span class="kt">char</span> <span class="o">*</span><span class="n">cstr2_cniu</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">str2_cniu</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>  <span class="c1">// added by cniu
</span>    <span class="n">strcpy</span><span class="p">(</span><span class="n">cstr1_cniu</span><span class="p">,</span><span class="n">str1_cniu</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>               <span class="c1">// added by cniu
</span>    <span class="n">strcpy</span><span class="p">(</span><span class="n">cstr2_cniu</span><span class="p">,</span><span class="n">str2_cniu</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>               <span class="c1">// added by cniu
</span>    <span class="n">open_numbered_file</span><span class="p">(</span><span class="n">strfile</span><span class="p">,</span><span class="n">cstr1_cniu</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="s">".out"</span><span class="p">);</span>   <span class="c1">// changed by cniu
</span>    <span class="k">delete</span> <span class="p">[]</span> <span class="n">cstr1_cniu</span><span class="p">;</span>                               <span class="c1">// added by cniu
</span>    <span class="n">strfile</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios</span><span class="o">::</span><span class="n">fixed</span><span class="p">);</span>
    <span class="n">strfile</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="n">sigdig</span><span class="p">);</span>
    <span class="n">write_structure</span><span class="p">(</span><span class="n">best</span><span class="p">.</span><span class="n">str</span><span class="p">,</span><span class="n">ulat</span><span class="p">,</span><span class="n">site_type_list</span><span class="p">,</span><span class="n">atom_label</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">strfile</span><span class="p">);</span>
    <span class="n">ofstream</span> <span class="n">corrfile</span><span class="p">;</span>
    <span class="n">open_numbered_file</span><span class="p">(</span><span class="n">corrfile</span><span class="p">,</span><span class="n">cstr2_cniu</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="s">".out"</span><span class="p">);</span>  <span class="c1">// changed by cniu
</span>    <span class="k">delete</span> <span class="p">[]</span> <span class="n">cstr2_cniu</span><span class="p">;</span>                               <span class="c1">// added by cniu
</span>    <span class="n">corrfile</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios</span><span class="o">::</span><span class="n">fixed</span><span class="p">);</span>
    <span class="n">corrfile</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="n">sigdig</span><span class="p">);</span>
</code></pre>
</div>
<p>Then compile ATAT as usual. Now the <code class="highlighter-rouge">mcsqs</code> code will save <code class="highlighter-rouge">bestsqs-1.out</code>, <code class="highlighter-rouge">bestsqs-2.out</code>, etc. with corresponding <code class="highlighter-rouge">bestcorr-1.out</code>, <code class="highlighter-rouge">bestcorr-2.out</code>, etc.</p>

<h2 id="generate-sqs">Generate SQS</h2>
<p>Two codes from the ATAT package are needed to generate SQS: <code class="highlighter-rouge">corrdump</code> and <code class="highlighter-rouge">mcsqs</code>.</p>

<h3 id="run-corrdump">Run corrdump</h3>
<p>The <code class="highlighter-rouge">corrdump</code> code needs an input file called <code class="highlighter-rouge">rndstr.in</code>. So let’s first talk about this input file.</p>

<h4 id="the-rndstrin-file">The rndstr.in file</h4>
<p>An example for FCC random solid solution:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1 1 1 90 90 90
.0 .5 .5
.5 .0 .5
.5 .5 .0
.0 .0 .0 Ni=.25,Fe=.25,Cr=.25,Co=.25
</code></pre>
</div>

<p>An example for L12 with partial ordering:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1 1 1 90 90 90
1 0 0
0 1 0
0 0 1
.0 .0 .0 Cr
.0 .5 .5 Ni=.333333,Fe=.333333,Co=.333334
.5 .0 .5 Ni=.333333,Fe=.333333,Co=.333334
.5 .5 .0 Ni=.333333,Fe=.333333,Co=.333334
</code></pre>
</div>

<p>An example for HCP random solid solution:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1 1 1.633 90 90 60
1 0 0
0 1 0
0 0 1
.000000 .000000 .0 Ni=.25,Fe=.25,Cr=.25,Co=.25
.666667 .666667 .5 Ni=.25,Fe=.25,Cr=.25,Co=.25
</code></pre>
</div>

<p>An example for D0-19 with partial ordering:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1 1 1.633 90 90 60
2 0 0
0 2 0
0 0 1
0.000000 0.000000 0.0 Cr
0.000000 1.000000 0.0 Ni=.333333,Fe=.333333,Co=.333334
1.000000 0.000000 0.0 Ni=.333333,Fe=.333333,Co=.333334
1.000000 1.000000 0.0 Ni=.333333,Fe=.333333,Co=.333334
0.666667 0.666667 0.5 Cr
1.666667 0.666667 0.5 Ni=.333333,Fe=.333333,Co=.333334
0.666667 1.666667 0.5 Ni=.333333,Fe=.333333,Co=.333334
1.666667 1.666667 0.5 Ni=.333333,Fe=.333333,Co=.333334
</code></pre>
</div>

<p>The <code class="highlighter-rouge">rndstr.in</code> input file can be divided into three parts: a unit cell (<strong>A</strong>), a periodic cell (<strong>B</strong>), and sites (<strong>C</strong>). The first line defines a unit cell (<strong>A</strong>) in the Cartesian system by defining the lengths of three vectors, <em>a, b, c</em>, and the angles, <em>alpha, beta, gamma</em>. This line can also be substituted by three lines, which represents the unit cell with a 3x3 matrix, like in a POSCAR. The purpose of the unit cell (<strong>A</strong>) is to provide a coordinate system in which the periodic cell (<strong>B</strong>) and sites (<strong>C</strong>) can be expressed. The next three lines define the periodic cell, which is the smallest supercell that represents the periodicity of the target materials. For example, a FCC random solid solution needs a one-atom FCC primitive cell, a HCP random solid solution needs a two-atom HCP primitive cell, and a L1-2 alloy needs a four-atom FCC cell. The periodic cell is expressed with the unit cell, which means the Cartesian coordinates of the periodic cell equal the multiplication of <strong>B</strong> and <strong>A</strong>. The third part is the lattice sites with atomic concentrations. Like the periodic cell (<strong>B</strong>), the site coordinates in <strong>C</strong> are also express with the unit cell (<strong>A</strong>), which means the Cartesian coordinates of the sites equal the multiplication of <strong>C</strong> and <strong>A</strong>. The concentrations of each component are suggested not to exceed 6 significant digits. The sum of concentrations on each site must always be 1.</p>

<p>Because the <code class="highlighter-rouge">rndstr.in</code> file is all about geometry, it is not necessary to consider the real lattice parameters in real materials. All previous examples use 1 for lattice parameter. This will make it easier to decide the <code class="highlighter-rouge">-2, -3</code> parameters later.</p>

<p>The <code class="highlighter-rouge">rndstr.in</code> file does not have anything to do with the final shape of the SQS. All it does is provide all the necessary symmetry input information. The size and shape of the final SQS is controlled by the <code class="highlighter-rouge">mcsqs</code> command.</p>

<h4 id="the--2--3-parameters">The “-2, -3” parameters</h4>
<p>With the <code class="highlighter-rouge">rndstr.in</code> file ready, it is now time to run the first command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>corrdump -l=rndstr.in -ro -noe -nop -clus -2=1.1
</code></pre>
</div>

<p>The command <code class="highlighter-rouge">corrdump</code> reads the lattice file <code class="highlighter-rouge">rndstr.in</code>, and calculates symmetries and clusters. This command usually finishes very quickly, unless a very large periodic cell is defined, in which case the output file <code class="highlighter-rouge">clusters.out</code> can become really huge and the command needs a few hours or more to finish. The most important parameter of this command is “<code class="highlighter-rouge">-2</code>”, which defines the longest distance, or cut-off,  when calculating the correlation functions. For example, in the case of FCC random solid solution, whose lattice parameter is 1, the first nearest neighbor distance is <code class="highlighter-rouge">2^.5/2=0.71</code>, the second nearest neighbor distance is <code class="highlighter-rouge">1.0</code>, and the third nearest neighbor distance is <code class="highlighter-rouge">1.5^.5=1.2</code>. So, the cutoff should be any value between <code class="highlighter-rouge">1.0</code> and <code class="highlighter-rouge">1.2</code> if the first two shells of nearest neighbors are to be considered for pair correlation functions. Similar to the “<code class="highlighter-rouge">-2</code>” parameter, there are “<code class="highlighter-rouge">-3</code>” and above parameters for triplet correlation functions or more.</p>

<p>Many beginners are not sure how to determine the <code class="highlighter-rouge">-2, -3</code> values, or how many shells of nearest neighbors to include for the matching of correlation functions. There are no general rules that work for all. Higher cutoff <code class="highlighter-rouge">-2, -3</code> values lead to better disorder in the final structure, but also requires much longer time for the <code class="highlighter-rouge">mcsqs</code> code to find a perfectly matched SQS. The best strategy is to start with lower cutoff values (e.g., 2 shells for pairs and ignore triplets) and increase them until a good SQS is reached. Find in the following sections about how to tell if a SQS is good.</p>

<h3 id="run-mcsqs">Run mcsqs</h3>

<p>The second command <code class="highlighter-rouge">mcsqs</code> searches SQS using a Monte Carlo algorithm with defined supercell size.</p>

<h4 id="regular-search">Regular search</h4>
<p>The regular search for SQS is performed by:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mcsqs -n XX
</code></pre>
</div>

<p>The number of atoms in the SQS, <code class="highlighter-rouge">XX</code>, must be appropriately decided. A minimal requirement is that this number must be a multiple of the number of sites in <code class="highlighter-rouge">rndstr.in</code> while also allowing integer number of atoms for all elements. For example, a ternary equiatomic L1-2 (4 sites in <code class="highlighter-rouge">rndstr.in</code>) SQS must contain at least 12 atoms.</p>

<p>The command <code class="highlighter-rouge">mcsqs</code> can run indefinitely, depending on the complexity of the material and the cutoffs. Usually the cutoff should include two shells; including more is usually not necessary, because if the correlation function mismatch of the second shell is not perfect, its error will most likely dominate outsider shells. For a binary alloy, the generation of SQS takes only a few seconds. For a quinary random alloy, it may never find a perfect SQS, and one that’s “good enough” may need a few days or even a couple of weeks. Here “good enough” is really up to the user’s determination. It can mean a maximum correlation mismatch of <code class="highlighter-rouge">0.1</code> or <code class="highlighter-rouge">0.01</code>.</p>

<p>If the revised version of <code class="highlighter-rouge">mcsqs</code> is used, a series of <code class="highlighter-rouge">bestsqs-XX.out</code> will be saved. The very last one has the best correlation mismatch, but whether it is the best option for further study is arguable. Usually a SQS which has very long lattice vectors and very small angles between lattice vectors should be avoided, because it is not a comfortable model for DFT calculations.</p>

<h4 id="search-with-a-fixed-cell">Search with a fixed cell</h4>
<p>It is possible to control the shape of SQS. One more file needs to be taken care with here: <code class="highlighter-rouge">sqscell.out</code>. This file can be generated by the <code class="highlighter-rouge">mcsqs</code> command. A typical <code class="highlighter-rouge">sqscell.out</code> looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>2

 3 -2  4
 3 -4  2
-2  4 -3

 3  0  0
 0  3  0
-1 -2  2
</code></pre>
</div>

<p>The first line tells the total number of cell shapes, followed by an empty line. The next three lines defines one cell shape of the SQS. This 3x3 matrix use Cartesian coordinates, NOT expressed with the unit cell in <code class="highlighter-rouge">rndstr.in</code>.</p>

<p>If we know what exact cell to fix for the SQS, we can put its lattice vectors in <code class="highlighter-rouge">sqscell.out</code>, which can be used to restrict the SQS generation by adding a parameter to the <code class="highlighter-rouge">mcsqs</code> command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mcsqs -rc -n 30
</code></pre>
</div>

<p>For example, if we want to build a 2-2-2 fcc supercell with 32 atoms, we can define the <code class="highlighter-rouge">sqscell.out</code> as:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>1

2 0 0
0 2 0
0 0 2
</code></pre>
</div>

<h4 id="search-for-sqs-like-a-cube">Search for SQS like a cube</h4>
<p>The most likely reason to control the shape of SQS is to make sure its shape is as close to a cube as possible, which allows equal K-points for DFT and less symmetry-related issues. This is different from the previous situation where the user knows what exact shape to use for the SQS. Now the cell shape is undetermined. For example, we want to generate a 36-atom quaternary equiatomic bcc SQS. It’s difficult to imagine the lattice vectors for a cells that is as close to a cube as possible. For this purpose, use the following steps:</p>

<ol>
  <li>Run <code class="highlighter-rouge">mcsqs -n 36</code>. Stop the <code class="highlighter-rouge">mcsqs</code> process as soon as it generates the <code class="highlighter-rouge">sqscell.out</code> file.</li>
  <li>Trim the <code class="highlighter-rouge">sqscell.out</code> file, and leave only cell shapes which have equal lattice vector lengths. If many cells have equal lengths, only use those with the shortest lengths, because it means they are the closest to a cubic shape.</li>
  <li>Restart <code class="highlighter-rouge">mcsqs -rc -n 36</code></li>
</ol>

<p>I know, Step 2 seems a boring task, so I wrote a python code for this:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#! /usr/bin/env python</span>
<span class="c">#</span>
<span class="c"># This script is written for Python 2.7.13.</span>
<span class="c">#</span>
<span class="c"># It copies sqscell.out (generated by mcsqs) to old-sqscell.out.</span>
<span class="c"># Then trim the sqscell.out to three or less cells. All cells have</span>
<span class="c"># equal-length lattice vectors. If more than three cells like this</span>
<span class="c"># exist in the original sqscell.out, it keeps three cells with the</span>
<span class="c"># smallest vector lengths.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># Read the original file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'sqscell.out'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f1</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="c"># Save the original file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'old-sqscell.out'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span> <span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c"># Replace it with a new file with 3 cells.</span>
<span class="c"># The 3 cells have the smallest and equal vector lengths</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'sqscell.out'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f3</span><span class="p">:</span>
    <span class="n">tot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>  <span class="c"># total number of cells</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">arr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">tot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tot</span><span class="p">):</span>
        <span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">]</span>
        <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">]</span>
        <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">]</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="p">(</span><span class="n">b1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
        <span class="n">l3</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
        <span class="k">if</span> <span class="n">l1</span> <span class="o">==</span> <span class="n">l2</span> <span class="ow">and</span> <span class="n">l2</span> <span class="o">==</span> <span class="n">l3</span><span class="p">:</span>
            <span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">arr1</span> <span class="o">=</span> <span class="n">arr1</span><span class="p">[</span><span class="n">arr1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">f3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'3</span><span class="se">\n\n</span><span class="s">'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tot</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">f3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">f3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">f3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n\n</span><span class="s">'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">etot</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">f3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">f3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">arr1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
</code></pre>
</div>
<p>Put this code in the same directory for <code class="highlighter-rouge">mcsqs</code>, the run it <code class="highlighter-rouge">python trim.py</code>.</p>

<h3 id="convert-sqs-to-poscar">Convert SQS to POSCAR</h3>
<p>The <code class="highlighter-rouge">bestsqs.out</code> files have similar formats as the <code class="highlighter-rouge">rndstr.in</code> file. The first three lines (<strong>A</strong>) is the previously defined unit cell. The next three lines (<strong>B</strong>) is the lattice vectors of the SQS expressed with the unit cell. All following (<strong>C</strong>) is the atomic coordinates expressed with the unit cell.</p>

<p>To convert this SQS output to POSCAR, first calculate the lattice vectors in POSCAR as a multiplication of <strong>B</strong> and <strong>A</strong>. Next calculate the atomic coordinates as a multiplication of <strong>C</strong> and <strong>A</strong>. Remember that the atoms in the <code class="highlighter-rouge">bestsqs.out</code> are not grouped by elements! Order them by element. Then use an experimental value of the lattice parameter for line 2 in the POSCAR. Now a POSCAR using “Cartesian” format is obtained. Finally, it is recommended to further convert the “Cartesian” POSCAR to a “Directional” POSCAR, because visualization softwares like CrystalMaker or VESTA have better behavior with the latter, and it is a very good habit to visualize the POSCAR before using it for expensive DFT calculations.</p>

<p>Again, this looks like another boring task, so I have a tool written in C++ for it as well. It is hosted on Github (<a href="https://github.com/changning/sqs2poscar" target="_blank">here</a><img src="/img/open_in_new_window.png" alt="img" height="20px" />).</p>

<h2 id="faqs">FAQs</h2>
<h3 id="how-to-tell-if-a-sqs-is-good">How to tell if a SQS is good?</h3>
<p>Even though elements have been assigned in <code class="highlighter-rouge">rndstr.in</code> when generating a SQS, they can be exchanged if any two elements are equivalent, that is, always having the same concentration on the same site. For example, any two elements can be exchanged in any equiatomic fcc SQS, because all elements are equivalent. The L1-2 SQS has three equivalent elements on the B-sites (Ni, Co, Fe in the previous <code class="highlighter-rouge">rndstr.in</code>). By exchanging equivalent elements in a SQS can we obtain more than one permutations of the same SQS.</p>

<p>A good SQS is expected to exhibit close performance among all of its permutations. The essential property is of course its total free energy. Ideally, the total free energies of all permutations of the same SQS are equal. But this almost never happens, because it’s almost never possible to obtain a SQS that has perfect correlation functions of pairs, triplets, …, with large enough cutoffs. The energy as a function of permutation fluctuates. The fluctuation can be small or large, depending on the material, the cell size and its correlation functions (the influence of the material is most significant). It is not necessary to persue a small fluctuation with much more time-consuming SQS generation, as long as the energy scattering does not impact your conclusions.</p>

<p>An example is Fig. 2 in one of my papers (C. Niu, et al., Spin-driven ordering of Cr in the equiatomic high entropy alloy NiFeCrCo, Appl. Phys. Lett. 106 (2015) 161906. <a href="http://aip.scitation.org/doi/10.1063/1.4918996" target="_blank">doi:10.1063/1.4918996</a><img src="/img/open_in_new_window.png" alt="img" height="20px" />):</p>

<p><img src="/img/2017-08-05-SQS-Fig2.png" alt="Fig-2" height="250px" /></p>

<p>The error bars in the right figure on all SQS columns are based on all possible permutations of the same SQS. As long as these error bars don’t have an influence on the energy comparison, it is OK to have them.</p>

<p><img src="/img/2017-08-05-SQS-Fig1.png" alt="Fig-1" heigh="250px" /></p>

<p>Besides total free energy, we can also use other properties to justify whether a SQS is good enough. Above is Fig. 1 in the same paper. The two subplots are from two different SQS – on the left is a small SQS with 24 atoms, and on the right is a large SQS with 120 atoms. Both SQS are for the same fcc random alloy, with similar correlation function settings. In each subplot, the magnetic moments of all atoms in all permutations are collected and plotted as a function of local neighboring magnetic environment. The right subplot has 4X more atoms, thus higher density of points. What I want to show here is that the two subplots show similar trends, which proves the accuracy of the smaller SQS. I also want to point that that this doesn’t mean a small SQS always works, but rather means it’s OK to use small SQS as long as it is proved to have good accuracy for the properties of interest.</p>


  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">
  <div class="wrapper">
      <div class="footer-col-wrapper">
          <p>Hosted on Github. Powered by Jekyll.</p>
      </div>
  </div>
</footer>


  </body>

</html>
